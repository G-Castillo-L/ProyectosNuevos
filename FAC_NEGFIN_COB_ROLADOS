SELECT 
  EXTRACT(YEAR FROM BEGINDT)*100 +EXTRACT(MONTH FROM BEGINDT) AS ANIOMES, 
      BEGINDT, 
      DMAGENCY,
      U6ORG,
      U6CYCDUE,
      U6BLOCKDATE1,
      --DMACCT,
      CTA_NIV_MOR,
      COUNT(CTA_CVE) CTA_CVE,
      SUM(CTA_SDO_ACT) SALDO_ACT

FROM crp-pro-dwh-semanticagold.EIL_DP_VRAW.VFAC_CYBERFIN_DELQUDA_BEGIN AS A
LEFT JOIN (SELECT ANIO, MES,CTA_CVE,CTA_NIV_MOR, TIP_INF,CTA_SDO_ACT FROM crp-pro-dwh-semanticagold.EIL_DP_VDWH.VFAC_SDO_CTA_MES
WHERE ANIO=2025 AND MES= 2 AND CTA_EDO_CVE NOT IN ('Z','T','9','8','P','Q','R')
) AS B
ON (A.DMACCT = B.CTA_CVE AND EXTRACT(YEAR FROM BEGINDT)=B.ANIO AND EXTRACT(MONTH FROM BEGINDT)=B.MES) --AND A.U6ORG=B.TIP_INF)
WHERE BEGINDT="2025-02-01"  --AND (DMAGENCY LIKE "SA%" OR DMAGENCY LIKE "DA%" OR DMAGENCY LIKE "MA%")

GROUP BY 1,2,3,4,5,6,7

;

create or replace table crp-sdx-cx-analitica.mus_sdx_neg_fin_tbls.FAC_NEGFIN_COB_ROLADOS
as

SELECT BEGINDT, DMAGENCY, U6ORG, U6CYCDUE, U6BLOCKDATE1,
COUNT(DMACCT)	CUENTAS, SUM(DMCURBAL) SALDO
FROM `crp-pro-dwh-semanticagold.EIL_DP_VRAW.VFAC_CYBERFIN_DELQUDA_BEGIN`
WHERE BEGINDT >= '2024-04-01'
AND (DMAGENCY LIKE 'DA001%'	OR DMAGENCY LIKE 'SA009%'	OR DMAGENCY LIKE 'SA001%'	OR DMAGENCY LIKE 'SAACA%'	OR DMAGENCY LIKE 'MA000%'
OR DMAGENCY LIKE 'SA008%'	OR DMAGENCY LIKE 'SA007%'	OR DMAGENCY LIKE 'MAXRE%'	OR DMAGENCY LIKE 'CA005%'	OR DMAGENCY LIKE 'DA002%'
OR DMAGENCY LIKE 'SALDO%'	OR DMAGENCY LIKE 'SA006%'	OR DMAGENCY LIKE 'MA006%'	OR DMAGENCY LIKE 'CA004%'	OR DMAGENCY LIKE 'MA008%'
OR DMAGENCY LIKE 'DA007%'	OR DMAGENCY LIKE 'DA009%'	OR DMAGENCY LIKE 'MA009%'	OR DMAGENCY LIKE 'DAN00%'	OR DMAGENCY LIKE 'DA008%'
OR DMAGENCY LIKE 'SA000%'	OR DMAGENCY LIKE 'DA006%'	OR DMAGENCY LIKE 'MA007%'	OR DMAGENCY LIKE 'CA001%'	OR DMAGENCY LIKE 'DA000%')
AND U6ORG IN (110,100,200,210)
GROUP BY BEGINDT, DMAGENCY, U6ORG, U6CYCDUE, U6BLOCKDATE1
